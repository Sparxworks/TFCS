<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  	<link type="text/css" href="jq/css/redmond/jquery-ui-1.8.22.custom.css" rel="stylesheet" />
  	<script type="text/javascript" src="jq/js/jquery-1.7.2.min.js"></script>
  	<script type="text/javascript" src="jq/js/jquery-ui-1.8.22.custom.min.js"></script>
	<script type="text/javascript" src="jstree/_lib/jquery.cookie.js"></script>
	<script type="text/javascript" src="jstree/_lib/jquery.hotkeys.js"></script>
	<script type="text/javascript" src="jstree/jquery.jstree.js"></script>
	<script type="text/javascript" src="jquery.jstree.east.js"></script>
	<link type="text/css" rel="stylesheet" href="jstree/_docs/syntax/!style.css"/>
	<link type="text/css" rel="stylesheet" href="jstree/_docs/!style.css"/>
	<script type="text/javascript" src="jstree/_docs/syntax/!script.js"></script>

<script type="text/javascript">
$(function () {
	$("#theTree")
		.jstree({
			"plugins" : ["themes","EAST_data","ui","hotkeys","types"]
			,"core" : { "animation" : 0 }
			,"ui" : {"select_limit" : 1}
			,"types":{
				"types":{
					"system":{}
					,"element":{"icon":{"image":"./icons/file.png"}}
					,"newelement" :{"icon":{"image":"./icons/newfile.png"}}
				}
			}
		})
//		.bind("dblclick.jstree", function (event) {
//		   var node = $(event.target).closest("li");
//		   var data = node.data("jstree");
		   // Do my action
//		   alert(data);
//		});
		.bind("select_node.jstree", function (event, data) { 
			var id = data.rslt.obj.attr("id");
			if(id != undefined){
//				if(id.substring(0,3) == "NEW"){
//					var name = prompt("Voer de naam in (zonder prefix)","")
//					if (name!=null && name!=""){
//						window.external.dict.add("RESULT",id+"."+name);
//						window.external.close();		
//					}
//				}else{
					window.external.dict.add("RESULT",id);
					window.external.close();		
//				}
			}
		})
//		.bind("loaded.jstree", function (event, data) {
//			// you get two params - event & data - check the core docs for a detailed description
//		})
//	setTimeout(function () { $.jstree._focused().select_node("#phtml_1"); }, 1000);
//	setTimeout(function () { $.jstree._reference("#phtml_1").close_node("#phtml_1"); }, 1500);
//	$("#demo1").bind("open_node.jstree", function (e, data) {
//		// data.inst is the instance which triggered this event
//		data.inst.select_node("#phtml_2", true);
//	});
//	setTimeout(function () { $.jstree._reference("#phtml_1").open_node("#phtml_1"); }, 2500);
		setTimeout(function () { $("#theTree").jstree("set_focus"); }, 500);
	});
	
    function createHTMLTree(){
		// Populate the tree using HTML as datasource. Tree structure: model - workflow type - workflow
		var innerHTML = "";
		var curTag = "";
		var curMdl = "";
		var dfltMdl = window.external.dict.item("DFLT_MDL");
		var dfltTag = window.external.dict.item("DFLT_TAG");
		var allowNew = window.external.dict.item("ALLOWNEW");
		var rows = window.external.dict.item("ROWS");
		var models = window.external.dict.item("MODELS");
		var newTags;
		if(allowNew != undefined){
			newTags = allowNew.split(",");
		}
		for( var i = 0; i<rows.count; i++){
			var row = rows.item(i);
			var ID = row.item("EA_GUID");
			var tag = row.item("VALUE");
			var text = row.item("NAME");
			var mdl = row.item("MODEL");
			if(curMdl != mdl){
				if(curMdl != ""){
					innerHTML+= "</ul></li>"
					if(curTag != ""){
						curTag = "";
						innerHTML+= "</ul></li>"
					}
				}
				if(dfltMdl == mdl){
					innerHTML+= "<li class='jstree-open'><a href='#'>"+mdl+"</a><ul>"
				}else{
					innerHTML+= "<li class='jstree-closed'><a href='#'>"+mdl+"</a><ul>"
				}
				if(allowNew != undefined){
					for( var j = 0; j<newTags.length; j++){
						innerHTML += "<li id='NEW"+mdl+"."+newTags[j]+"' rel='newelement'><a href='#'>Nieuwe "+newTags[j]+" maken</a></li>";
					}
				}
				curMdl = mdl;
			}
			if(tag != undefined && curTag != tag){
				if(curTag != ""){
					innerHTML+= "</ul></li>"
				}
				if(dfltTag == tag){
					innerHTML+= "<li class='jstree-open'><a href='#'>"+tag+"</a><ul>"
				}else{
					innerHTML+= "<li class='jstree-closed'><a href='#'>"+tag+"</a><ul>"
				}
				curTag = tag;
			}
			innerHTML += "<li id='"+ID+"' rel='element'><a href='#'>"+text+"</a></li>";
		}
		if(curMdl != ""){
			innerHTML+= "</ul></li>"
		}
		if(curTag != ""){
			innerHTML+= "</ul></li>"
		}		
		if(allowNew != undefined){
			for( i = 0; i<models.count; i++){
				var row = models.item(i);
				var mdl = row.item("NAME");
				if(innerHTML.indexOf("<a href='#'>"+mdl+"</a>") == -1){
					if(dfltMdl == mdl){
						innerHTML+= "<li class='jstree-open'><a href='#'>"+mdl+"</a><ul>"
					}else{
						innerHTML+= "<li class='jstree-closed'><a href='#'>"+mdl+"</a><ul>"
					}
					for( var j = 0; j<newTags.length; j++){
						innerHTML += "<li id='NEW"+mdl+"."+newTags[j]+"' rel='newelement'><a href='#'>Nieuwe "+newTags[j]+" maken</a></li>";
					}
					innerHTML+= "</ul></li>"
				}
			}
		}

//		innerHTML = "<ul>"+innerHTML+"</ul>";
//		var tree = document.getElementById("theTree");
//		tree.innerHTML = "<ul>"+innerHTML+"</ul>";

		return innerHTML;
	}
		
   function onLoad(){
		window.external.SetDimensions(400,450);
    }
</script>

</head>
 
<script type="text/javascript">
	$(document).ready(function() {
		onLoad();
	})
</script>
</head>

<body style="background:#e9e9d8 !important;">
<br>
<div id="theTree" style="height:380px; width:90%;`; overflow-y:scroll;margin-left:auto;margin-right:auto; border-style:inset">
</div>
<div style="background:#e9e9d8 !important;">
<br>
</div>
</body>
</html>

